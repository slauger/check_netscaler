/*
 * check_netscaler v2.0 - Icinga 2 CheckCommand Definitions
 * https://github.com/slauger/check_netscaler
 */

// Common NetScaler check template
template CheckCommand "netscaler-common" {
  command = [ "/opt/check_netscaler/check_netscaler.py" ]

  arguments = {
    "--hostname" = {
      value = "$netscaler_hostname$"
      description = "NetScaler hostname or IP"
    }
    "--username" = {
      value = "$netscaler_username$"
      description = "Username"
    }
    "--password" = {
      value = "$netscaler_password$"
      description = "Password"
    }
    "--no-ssl" = {
      set_if = "$netscaler_no_ssl$"
      description = "Use HTTP instead of HTTPS"
    }
    "--port" = {
      value = "$netscaler_port$"
      description = "TCP port"
    }
    "--timeout" = {
      value = "$netscaler_timeout$"
      description = "Timeout in seconds"
    }
    "--api" = {
      value = "$netscaler_api$"
      description = "API version (v1/v2)"
    }
  }

  vars.netscaler_hostname = "$host.address$"
  vars.netscaler_username = "nsroot"
  vars.netscaler_password = "nsroot"
  // SSL/HTTPS is default, use vars.netscaler_no_ssl = true for HTTP
  vars.netscaler_timeout = 10
}

// State check
object CheckCommand "netscaler_state" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "state"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
      description = "Object type (lbvserver, service, servicegroup, server)"
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
      description = "Object name"
    }
    "--filter" = {
      value = "$netscaler_filter$"
      description = "Regex filter"
    }
    "--limit" = {
      value = "$netscaler_limit$"
      description = "Regex limit (inverse filter)"
    }
  }
}

// Above threshold check
object CheckCommand "netscaler_above" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "above"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
    }
    "-n" = {
      value = "$netscaler_field$"
      required = true
      description = "Field name(s) comma-separated"
    }
    "--warning" = {
      value = "$netscaler_warning$"
      required = true
    }
    "--critical" = {
      value = "$netscaler_critical$"
      required = true
    }
  }
}

// Below threshold check
object CheckCommand "netscaler_below" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "below"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
    }
    "-n" = {
      value = "$netscaler_field$"
      required = true
    }
    "--warning" = {
      value = "$netscaler_warning$"
      required = true
    }
    "--critical" = {
      value = "$netscaler_critical$"
      required = true
    }
  }
}

// SSL certificate expiration
object CheckCommand "netscaler_sslcert" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "sslcert"
    }
    "--warning" = {
      value = "$netscaler_warning$"
      description = "Warning threshold (days)"
    }
    "--critical" = {
      value = "$netscaler_critical$"
      description = "Critical threshold (days)"
    }
    "--filter" = {
      value = "$netscaler_filter$"
    }
    "--limit" = {
      value = "$netscaler_limit$"
    }
  }

  vars.netscaler_warning = 30
  vars.netscaler_critical = 10
}

// HA status
object CheckCommand "netscaler_hastatus" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "hastatus"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
    }
  }
}

// Network interfaces
object CheckCommand "netscaler_interfaces" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "interfaces"
    }
    "--filter" = {
      value = "$netscaler_filter$"
    }
    "--limit" = {
      value = "$netscaler_limit$"
    }
    "--separator" = {
      value = "$netscaler_separator$"
    }
  }
}

// ServiceGroup quorum
object CheckCommand "netscaler_servicegroup" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "servicegroup"
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
      required = true
      description = "ServiceGroup name"
    }
    "--warning" = {
      value = "$netscaler_warning$"
      description = "Warning threshold (percentage)"
    }
    "--critical" = {
      value = "$netscaler_critical$"
      description = "Critical threshold (percentage)"
    }
    "--separator" = {
      value = "$netscaler_separator$"
    }
  }
}

// Performance data collection
object CheckCommand "netscaler_perfdata" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "perfdata"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "-n" = {
      value = "$netscaler_field$"
      required = true
      description = "Field name(s) comma-separated"
    }
    "--label" = {
      value = "$netscaler_label$"
    }
    "--separator" = {
      value = "$netscaler_separator$"
    }
  }
}

// License expiration
object CheckCommand "netscaler_license" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "license"
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
      description = "License filename"
    }
    "--warning" = {
      value = "$netscaler_warning$"
    }
    "--critical" = {
      value = "$netscaler_critical$"
    }
  }

  vars.netscaler_warning = 30
  vars.netscaler_critical = 10
}

// NTP synchronization
object CheckCommand "netscaler_ntp" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "ntp"
    }
    "--warning" = {
      value = "$netscaler_warning$"
      description = "Warning thresholds (o=offset,s=stratum,j=jitter,t=truechimers)"
    }
    "--critical" = {
      value = "$netscaler_critical$"
      description = "Critical thresholds"
    }
  }
}

// Unsaved configuration
object CheckCommand "netscaler_nsconfig" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "nsconfig"
    }
  }
}

// String matching (equals)
object CheckCommand "netscaler_matches" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "matches"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "-n" = {
      value = "$netscaler_field$"
      required = true
    }
    "--warning" = {
      value = "$netscaler_warning$"
      required = true
    }
    "--critical" = {
      value = "$netscaler_critical$"
      required = true
    }
    "--label" = {
      value = "$netscaler_label$"
    }
    "--separator" = {
      value = "$netscaler_separator$"
    }
  }
}

// String matching (not equals)
object CheckCommand "netscaler_matches_not" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "matches_not"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "-n" = {
      value = "$netscaler_field$"
      required = true
    }
    "--warning" = {
      value = "$netscaler_warning$"
      required = true
    }
    "--critical" = {
      value = "$netscaler_critical$"
      required = true
    }
    "--label" = {
      value = "$netscaler_label$"
    }
    "--separator" = {
      value = "$netscaler_separator$"
    }
  }
}

// STA server availability
object CheckCommand "netscaler_staserver" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "staserver"
    }
    "--filter" = {
      value = "$netscaler_filter$"
    }
    "--limit" = {
      value = "$netscaler_limit$"
    }
  }
}

// Hardware information
object CheckCommand "netscaler_hwinfo" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "hwinfo"
    }
  }
}

// Debug output
object CheckCommand "netscaler_debug" {
  import "netscaler-common"

  arguments += {
    "--command" = {
      value = "debug"
    }
    "--objecttype" = {
      value = "$netscaler_objecttype$"
      required = true
    }
    "--objectname" = {
      value = "$netscaler_objectname$"
    }
  }
}
